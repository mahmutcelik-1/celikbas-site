<!DOCTYPE html>
<html lang="tr" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Çelikbaş Pompa & Enjektör | Profesyonel Dizel Servisi</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <script src="https://www.google.com/recaptcha/api.js" async defer></script>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Outfit', 'sans-serif'],
                    },
                    colors: {
                        primary: {
                            DEFAULT: '#0a2351',
                            dark: '#051535',
                            light: '#1e3a8a'
                        },
                        accent: {
                            DEFAULT: '#FFD700',
                            hover: '#E6C200'
                        }
                    },
                    boxShadow: {
                        'glass': '0 8px 32px 0 rgba(31, 38, 135, 0.15)',
                        'glow': '0 0 20px rgba(255, 215, 0, 0.3)',
                    },
                    animation: {
                        'fade-in-up': 'fadeInUp 0.6s ease-out forwards',
                        'slide-in-right': 'slideInRight 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards',
                        'float': 'float 6s ease-in-out infinite',
                    },
                    keyframes: {
                        fadeInUp: {
                            '0%': { opacity: '0', transform: 'translateY(20px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        },
                        slideInRight: {
                            '0%': { transform: 'translateX(100%)' },
                            '100%': { transform: 'translateX(0)' },
                        },
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-10px)' },
                        }
                    }
                }
            }
        }
    </script>

    <style>
        /* Custom Styles & Utilities */
        body {
            -webkit-tap-highlight-color: transparent;
        }

        /* Glassmorphism Utilities */
        .glass {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
        }
        
        .glass-dark {
            background: rgba(10, 35, 81, 0.85);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        /* Scrollbar Styling */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f5f9;
        }
        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }

        /* Page Transitions */
        .view-section {
            display: none;
            opacity: 0;
            transition: opacity 0.4s ease-in-out, transform 0.4s ease-out;
        }

        .view-section.active {
            display: block;
            animation: fadeInPage 0.5s ease-out forwards;
        }

        @keyframes fadeInPage {
            from { opacity: 0; transform: translateY(10px) scale(0.99); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }

        /* Scroll Reveal Class */
        .reveal {
            opacity: 0;
            transform: translateY(30px);
            transition: all 0.8s cubic-bezier(0.5, 0, 0, 1);
        }
        .reveal.active {
            opacity: 1;
            transform: translateY(0);
        }

        /* Mobile Menu Transition */
        #mobile-menu-overlay {
            transition: opacity 0.3s ease-in-out, visibility 0.3s;
        }
        #mobile-menu-content {
            transition: transform 0.4s cubic-bezier(0.16, 1, 0.3, 1);
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800 font-sans antialiased overflow-x-hidden">

    <nav class="glass-dark fixed w-full z-50 transition-all duration-300" id="navbar">
        <div class="container mx-auto px-6 py-4 flex justify-between items-center">
            <div class="flex items-center gap-3 cursor-pointer group" onclick="switchView('home-view')">
                <div class="w-10 h-10 bg-accent rounded-xl flex items-center justify-center transform group-hover:rotate-12 transition-transform duration-300 shadow-glow">
                    <i data-lucide="fuel" class="text-primary w-6 h-6"></i>
                </div>
                <div class="flex flex-col">
                    <h1 class="text-xl font-bold text-white tracking-wide leading-none">ÇELİKBAŞ</h1>
                    <span class="text-[10px] text-gray-400 uppercase tracking-[0.2em] font-medium mt-1">Pompa & Enjektör</span>
                </div>
            </div>

            <div class="hidden md:flex items-center space-x-8">
                <button onclick="scrollToSection('hizmetler')" class="text-gray-300 hover:text-accent text-sm font-medium transition-colors relative after:content-[''] after:absolute after:-bottom-1 after:left-0 after:w-0 after:h-0.5 after:bg-accent after:transition-all hover:after:w-full">Hizmetler</button>
                <button onclick="scrollToSection('galeri')" class="text-gray-300 hover:text-accent text-sm font-medium transition-colors relative after:content-[''] after:absolute after:-bottom-1 after:left-0 after:w-0 after:h-0.5 after:bg-accent after:transition-all hover:after:w-full">Galeri</button>
                <button onclick="scrollToSection('iletisim')" class="text-gray-300 hover:text-accent text-sm font-medium transition-colors relative after:content-[''] after:absolute after:-bottom-1 after:left-0 after:w-0 after:h-0.5 after:bg-accent after:transition-all hover:after:w-full">İletişim</button>
                <button onclick="switchView('admin-login-view')" class="text-gray-400 hover:text-white text-xs font-medium border border-white/10 px-3 py-1 rounded-full transition-colors">Yönetici</button>
                
                <button onclick="switchView('booking-form-view')" class="bg-accent hover:bg-accent-hover text-primary px-6 py-2.5 rounded-full font-bold text-sm transition-all shadow-lg hover:shadow-glow hover:-translate-y-0.5 transform active:scale-95 flex items-center gap-2">
                    <span>Randevu Al</span>
                    <i data-lucide="calendar-plus" class="w-4 h-4"></i>
                </button>
            </div>

            <button class="md:hidden text-white p-2 hover:bg-white/10 rounded-lg transition-colors" onclick="toggleMobileMenu()">
                <i data-lucide="menu" class="w-6 h-6"></i>
            </button>
        </div>
    </nav>

    <div id="mobile-menu-overlay" class="fixed inset-0 z-[60] invisible opacity-0 md:hidden">
        <div class="absolute inset-0 bg-black/60 backdrop-blur-sm" onclick="toggleMobileMenu()"></div>
        <div id="mobile-menu-content" class="absolute top-0 right-0 w-[280px] h-full bg-primary-dark shadow-2xl transform translate-x-full flex flex-col p-6">
            <div class="flex justify-between items-center mb-8 pb-4 border-b border-white/10">
                <span class="text-white font-bold text-lg">Menü</span>
                <button onclick="toggleMobileMenu()" class="text-gray-400 hover:text-white p-2 rounded-full hover:bg-white/10 transition-colors">
                    <i data-lucide="x" class="w-6 h-6"></i>
                </button>
            </div>
            
            <div class="flex flex-col space-y-2">
                <button onclick="mobileNavigate('hizmetler')" class="text-gray-300 hover:text-accent text-left py-3 px-4 rounded-xl hover:bg-white/5 transition-all flex items-center gap-3">
                    <i data-lucide="wrench" class="w-5 h-5 text-accent"></i> Hizmetler
                </button>
                <button onclick="mobileNavigate('galeri')" class="text-gray-300 hover:text-accent text-left py-3 px-4 rounded-xl hover:bg-white/5 transition-all flex items-center gap-3">
                    <i data-lucide="image" class="w-5 h-5 text-accent"></i> Galeri
                </button>
                <button onclick="mobileNavigate('iletisim')" class="text-gray-300 hover:text-accent text-left py-3 px-4 rounded-xl hover:bg-white/5 transition-all flex items-center gap-3">
                    <i data-lucide="phone" class="w-5 h-5 text-accent"></i> İletişim
                </button>
                <button onclick="switchView('admin-login-view'); toggleMobileMenu();" class="text-gray-500 hover:text-white text-left py-3 px-4 rounded-xl text-sm transition-all flex items-center gap-3 mt-4 border-t border-white/5">
                    <i data-lucide="lock" class="w-4 h-4"></i> Yönetici Girişi
                </button>
            </div>

            <div class="mt-auto">
                <button onclick="switchView('booking-form-view'); toggleMobileMenu();" class="w-full bg-accent hover:bg-accent-hover text-primary font-bold py-4 rounded-xl shadow-lg transition-transform active:scale-95 flex items-center justify-center gap-2">
                    <i data-lucide="calendar-check" class="w-5 h-5"></i>
                    Hemen Randevu Al
                </button>
            </div>
        </div>
    </div>

    <main class="min-h-screen">
        
        <div id="home-view" class="view-section active">
            <div class="relative min-h-screen flex items-center pt-20 overflow-hidden">
                <div class="absolute inset-0 z-0">
                    <img src="https://images.unsplash.com/photo-1486262715619-67b85e0b08d3?q=80&w=2000&auto=format&fit=crop" class="w-full h-full object-cover scale-105 animate-[pulse_10s_ease-in-out_infinite]" alt="Hero Background">
                    <div class="absolute inset-0 bg-gradient-to-r from-primary-dark via-primary-dark/95 to-primary-dark/70"></div>
                </div>

                <div class="container mx-auto px-6 relative z-10 flex flex-col md:flex-row items-center gap-12 mt-8">
                    <div class="md:w-1/2 text-center md:text-left animate-fade-in-up">
                        <div class="inline-flex items-center gap-2 bg-white/5 border border-white/10 rounded-full px-4 py-1.5 mb-8 backdrop-blur-md shadow-lg">
                            <span class="relative flex h-3 w-3">
                                <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-accent opacity-75"></span>
                                <span class="relative inline-flex rounded-full h-3 w-3 bg-accent"></span>
                            </span>
                            <span class="text-xs font-semibold text-gray-200 tracking-wider uppercase">İstanbul'un En İyi Dizel Servisi</span>
                        </div>
                        
                        <h1 class="text-4xl md:text-6xl lg:text-7xl font-extrabold text-white leading-tight mb-6 tracking-tight">
                            Aracınızın Kalbi <br/>
                            <span class="text-transparent bg-clip-text bg-gradient-to-r from-accent to-yellow-200">Kusursuz</span> Çalışsın
                        </h1>
                        
                        <p class="text-lg text-gray-300 mb-10 max-w-lg mx-auto md:mx-0 font-light leading-relaxed">
                            20 yıllık tecrübe ile dizel pompa tamiri, enjektör temizliği ve common rail sistemlerinde garantili çözüm ortağınız.
                        </p>
                        
                        <div class="flex flex-col sm:flex-row gap-4 justify-center md:justify-start">
                            <button onclick="switchView('booking-form-view')" class="group bg-accent hover:bg-accent-hover text-primary px-8 py-4 rounded-xl font-bold text-lg transition-all shadow-glow hover:scale-105 flex items-center justify-center gap-2">
                                Randevu Oluştur 
                                <i data-lucide="arrow-right" class="w-5 h-5 group-hover:translate-x-1 transition-transform"></i>
                            </button>
                            <button onclick="scrollToSection('iletisim')" class="group bg-white/5 hover:bg-white/10 text-white border border-white/20 px-8 py-4 rounded-xl font-semibold text-lg transition-all backdrop-blur-sm hover:border-white/40 flex items-center justify-center gap-2">
                                <i data-lucide="phone" class="w-5 h-5 group-hover:rotate-12 transition-transform"></i> 
                                Bizi Arayın
                            </button>
                        </div>
                    </div>

                    <div class="md:w-1/2 relative hidden md:block">
                        <div class="relative z-10 rounded-3xl overflow-hidden border border-white/10 shadow-2xl animate-float">
                             <img src="https://images.unsplash.com/photo-1597762696017-d7162624d77d?ixlib=rb-1.2.1&auto=format&fit=crop&w=800&q=80" class="w-full h-auto object-cover" alt="Service">
                             <div class="absolute inset-0 bg-gradient-to-t from-primary-dark/80 to-transparent"></div>
                             
                             <div class="absolute bottom-6 left-6 right-6 bg-white/10 backdrop-blur-md border border-white/20 p-4 rounded-xl flex items-center gap-4">
                                <div class="w-12 h-12 rounded-full bg-accent flex items-center justify-center text-primary font-bold text-xl">20</div>
                                <div>
                                    <p class="text-white font-bold">Yıllık Tecrübe</p>
                                    <p class="text-gray-300 text-xs">Sektörün güvenilir ismi</p>
                                </div>
                             </div>
                        </div>
                        <div class="absolute -top-10 -right-10 w-64 h-64 bg-accent/20 rounded-full blur-3xl -z-10 animate-pulse"></div>
                    </div>
                </div>
                
                <div class="absolute bottom-8 left-1/2 transform -translate-x-1/2 animate-bounce text-white/50 hidden md:block">
                    <i data-lucide="chevron-down" class="w-8 h-8"></i>
                </div>
            </div>

            <div class="bg-white border-b border-gray-100 relative z-20 -mt-8 mx-4 md:mx-auto md:max-w-6xl rounded-2xl shadow-xl p-8 reveal">
                <div class="grid grid-cols-2 md:grid-cols-3 gap-8">
                    <div class="flex flex-col items-center text-center group">
                        <div class="w-14 h-14 bg-blue-50 text-primary rounded-2xl flex items-center justify-center mb-3 group-hover:scale-110 transition-transform duration-300"><i data-lucide="clock" class="w-7 h-7"></i></div>
                        <h4 class="text-2xl font-bold text-primary">Hızlı</h4>
                        <p class="text-sm text-gray-500">Aynı Gün Teslim</p>
                    </div>
                    <div class="flex flex-col items-center text-center group">
                        <div class="w-14 h-14 bg-blue-50 text-primary rounded-2xl flex items-center justify-center mb-3 group-hover:scale-110 transition-transform duration-300"><i data-lucide="users" class="w-7 h-7"></i></div>
                        <h4 class="text-2xl font-bold text-primary">5000+</h4>
                        <p class="text-sm text-gray-500">Mutlu Müşteri</p>
                    </div>
                    <div class="flex flex-col items-center text-center group">
                        <div class="w-14 h-14 bg-blue-50 text-primary rounded-2xl flex items-center justify-center mb-3 group-hover:scale-110 transition-transform duration-300"><i data-lucide="wrench" class="w-7 h-7"></i></div>
                        <h4 class="text-2xl font-bold text-primary">7/24</h4>
                        <p class="text-sm text-gray-500">Acil Destek</p>
                    </div>
                </div>
            </div>

            <div id="hizmetler" class="py-24 bg-gray-50">
                <div class="container mx-auto px-6">
                    <div class="text-center mb-16 max-w-2xl mx-auto reveal">
                        <span class="text-accent font-bold tracking-wider text-xs uppercase bg-accent/10 px-3 py-1 rounded-full">Uzmanlık Alanlarımız</span>
                        <h2 class="text-3xl md:text-4xl font-bold text-primary mt-4 mb-4">Profesyonel Bakım Hizmetleri</h2>
                        <p class="text-gray-500">En son teknoloji cihazlarımız ve uzman kadromuzla aracınızın performansını zirveye taşıyoruz.</p>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                        <div class="bg-white p-8 rounded-3xl shadow-sm hover:shadow-xl hover:-translate-y-2 transition-all duration-300 border border-gray-100 group reveal">
                            <div class="w-16 h-16 bg-primary text-white rounded-2xl flex items-center justify-center mb-6 group-hover:bg-accent group-hover:text-primary transition-colors shadow-lg shadow-primary/20">
                                <i data-lucide="wrench" class="w-8 h-8"></i>
                            </div>
                            <h3 class="text-xl font-bold text-primary mb-3">Enjektör Tamiri</h3>
                            <p class="text-gray-500 text-sm leading-relaxed">Bosch, Delphi, Siemens ve Denso enjektörlerin bilgisayarlı test ve onarımı.</p>
                        </div>
                         <div class="bg-white p-8 rounded-3xl shadow-sm hover:shadow-xl hover:-translate-y-2 transition-all duration-300 border border-gray-100 group reveal" style="transition-delay: 100ms;">
                            <div class="w-16 h-16 bg-primary text-white rounded-2xl flex items-center justify-center mb-6 group-hover:bg-accent group-hover:text-primary transition-colors shadow-lg shadow-primary/20">
                                <i data-lucide="fuel" class="w-8 h-8"></i>
                            </div>
                            <h3 class="text-xl font-bold text-primary mb-3">Pompa Revizyonu</h3>
                            <p class="text-gray-500 text-sm leading-relaxed">Dizel pompalarınızın fabrika standartlarına göre kalibrasyon ve revizyonu.</p>
                        </div>
                        <div class="bg-white p-8 rounded-3xl shadow-sm hover:shadow-xl hover:-translate-y-2 transition-all duration-300 border border-gray-100 group reveal" style="transition-delay: 200ms;">
                            <div class="w-16 h-16 bg-primary text-white rounded-2xl flex items-center justify-center mb-6 group-hover:bg-accent group-hover:text-primary transition-colors shadow-lg shadow-primary/20">
                                <i data-lucide="laptop" class="w-8 h-8"></i>
                            </div>
                            <h3 class="text-xl font-bold text-primary mb-3">Arıza Tespiti</h3>
                            <p class="text-gray-500 text-sm leading-relaxed">Yeni nesil diagnostik cihazlarla nokta atışı arıza tespiti ve detaylı raporlama.</p>
                        </div>
                        <div class="bg-white p-8 rounded-3xl shadow-sm hover:shadow-xl hover:-translate-y-2 transition-all duration-300 border border-gray-100 group reveal" style="transition-delay: 300ms;">
                            <div class="w-16 h-16 bg-primary text-white rounded-2xl flex items-center justify-center mb-6 group-hover:bg-accent group-hover:text-primary transition-colors shadow-lg shadow-primary/20">
                                <i data-lucide="layers" class="w-8 h-8"></i>
                            </div>
                            <h3 class="text-xl font-bold text-primary mb-3">Yedek Parça</h3>
                            <p class="text-gray-500 text-sm leading-relaxed">Tüm marka ve model araçlar için orijinal yedek parça temini.</p>
                        </div>
                    </div>
                </div>
            </div>

            <div id="galeri" class="py-24 bg-white">
                <div class="container mx-auto px-6">
                    <div class="flex justify-between items-end mb-12 reveal">
                        <div>
                            <span class="text-accent font-bold tracking-wider text-xs uppercase">Galeri</span>
                            <h2 class="text-3xl font-bold text-primary mt-2">Servisimizden Kareler</h2>
                        </div>
                        <div class="hidden md:flex gap-2">
                             <button class="p-3 rounded-full border border-gray-200 hover:bg-gray-50 transition"><i data-lucide="arrow-left" class="w-5 h-5"></i></button>
                             <button class="p-3 rounded-full border border-gray-200 hover:bg-gray-50 transition"><i data-lucide="arrow-right" class="w-5 h-5"></i></button>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
                        <div class="group rounded-2xl overflow-hidden relative aspect-[4/3] reveal">
                            <img src="https://images.unsplash.com/photo-1486262715619-67b85e0b08d3?auto=format&fit=crop&w=600&q=80" class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-700" alt="Galeri">
                            <div class="absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex items-center justify-center">
                                <i data-lucide="zoom-in" class="text-white w-8 h-8"></i>
                            </div>
                        </div>
                        <div class="group rounded-2xl overflow-hidden relative aspect-[4/3] reveal" style="transition-delay: 100ms;">
                            <img src="https://images.unsplash.com/photo-1597762696017-d7162624d77d?auto=format&fit=crop&w=600&q=80" class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-700" alt="Galeri">
                            <div class="absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex items-center justify-center">
                                <i data-lucide="zoom-in" class="text-white w-8 h-8"></i>
                            </div>
                        </div>
                        <div class="group rounded-2xl overflow-hidden relative aspect-[4/3] reveal" style="transition-delay: 200ms;">
                            <img src="https://images.unsplash.com/photo-1530046339160-ce3e530c7d2f?auto=format&fit=crop&w=600&q=80" class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-700" alt="Galeri">
                            <div class="absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex items-center justify-center">
                                <i data-lucide="zoom-in" class="text-white w-8 h-8"></i>
                            </div>
                        </div>
                        <div class="group rounded-2xl overflow-hidden relative aspect-[4/3] reveal" style="transition-delay: 300ms;">
                            <img src="https://images.unsplash.com/photo-1625047509248-ec889cbff17f?auto=format&fit=crop&w=600&q=80" class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-700" alt="Galeri">
                            <div class="absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex items-center justify-center">
                                <i data-lucide="zoom-in" class="text-white w-8 h-8"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="iletisim" class="py-24 bg-primary relative overflow-hidden">
                <div class="absolute top-0 right-0 w-full h-full opacity-10" style="background-image: radial-gradient(#FFD700 1px, transparent 1px); background-size: 30px 30px;"></div>

                <div class="container mx-auto px-6 relative z-10 grid lg:grid-cols-2 gap-16 items-center reveal">
                    <div>
                        <span class="text-accent font-bold tracking-widest uppercase text-xs">Bize Ulaşın</span>
                        <h2 class="text-4xl font-bold text-white mt-2 mb-8">İletişim Bilgileri</h2>
                        <div class="space-y-6">
                            <div class="flex items-center gap-6 p-4 rounded-xl bg-white/5 border border-white/10 hover:bg-white/10 transition">
                                <div class="w-12 h-12 rounded-full bg-accent/20 flex items-center justify-center text-accent"><i data-lucide="map-pin"></i></div>
                                <div>
                                    <p class="text-gray-400 text-xs uppercase">Adres</p>
                                    <p class="text-white font-medium">Sanayi Mahallesi, Sultanbeyli, İstanbul</p>
                                </div>
                            </div>
                            <div class="flex items-center gap-6 p-4 rounded-xl bg-white/5 border border-white/10 hover:bg-white/10 transition">
                                <div class="w-12 h-12 rounded-full bg-accent/20 flex items-center justify-center text-accent"><i data-lucide="phone"></i></div>
                                <div>
                                    <p class="text-gray-400 text-xs uppercase">Telefon</p>
                                    <a href="tel:+905363374936" class="text-white font-medium hover:text-accent transition">0 536 337 49 36</a>
                                </div>
                            </div>
                            <div class="flex items-center gap-6 p-4 rounded-xl bg-white/5 border border-white/10 hover:bg-white/10 transition">
                                <div class="w-12 h-12 rounded-full bg-accent/20 flex items-center justify-center text-accent"><i data-lucide="clock"></i></div>
                                <div>
                                    <p class="text-gray-400 text-xs uppercase">Çalışma Saatleri</p>
                                    <p class="text-white font-medium">Pazartesi - Cumartesi: 08:30 - 19:00</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="h-[450px] bg-white rounded-3xl overflow-hidden shadow-2xl relative p-2 transform rotate-1 hover:rotate-0 transition-transform duration-500">
                        <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3013.923831899531!2d29.2957534!3d40.9517639!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x14cad114fd0add89%3A0xadca6a2ca1a986bf!2zw4dFTMSwS0JBxZ4gUE9NUEEgRU5KRUtUw5ZSIFNFUlbEsFPEsCBTVUxUQU5CRVlMxLA!5e0!3m2!1str!2str!4v1703254500000!5m2!1str!2str" width="100%" height="100%" style="border:0; border-radius: 20px;" allowfullscreen="" loading="lazy"></iframe>
                    </div>
                </div>
            </div>
            
            <footer class="bg-primary-dark text-white py-12 border-t border-white/10 text-center relative z-10">
                <div class="container mx-auto px-6">
                    <div class="flex flex-col md:flex-row justify-between items-center gap-6">
                        <div class="flex items-center gap-2">
                             <i data-lucide="fuel" class="text-accent w-5 h-5"></i>
                             <span class="font-bold tracking-wide">ÇELİKBAŞ</span>
                        </div>
                        <p class="text-gray-500 text-sm">© 2025 Çelikbaş Pompa Enjektör Servisi. Tüm hakları saklıdır.</p>
                        <div class="flex gap-4">
                            <a href="#" class="text-gray-400 hover:text-accent transition"><i data-lucide="instagram" class="w-5 h-5"></i></a>
                            <a href="#" class="text-gray-400 hover:text-accent transition"><i data-lucide="facebook" class="w-5 h-5"></i></a>
                        </div>
                    </div>
                </div>
            </footer>
        </div>

        <div id="booking-form-view" class="view-section min-h-screen bg-gray-50">
            <div class="flex flex-col lg:flex-row min-h-screen">
                <div class="hidden lg:block w-5/12 bg-primary relative overflow-hidden">
                    <img src="https://images.unsplash.com/photo-1619642751034-765dfdf7c58e?auto=format&fit=crop&w=1000&q=80" class="w-full h-full object-cover opacity-40 mix-blend-overlay" alt="Booking">
                    <div class="absolute inset-0 bg-gradient-to-t from-primary via-primary/80 to-transparent"></div>
                    <div class="absolute bottom-16 left-12 right-12 text-white">
                        <div class="w-16 h-16 bg-accent rounded-2xl flex items-center justify-center mb-6 text-primary">
                            <i data-lucide="calendar-clock" class="w-8 h-8"></i>
                        </div>
                        <h2 class="text-4xl font-bold mb-4">Zamanınız Değerli</h2>
                        <p class="text-gray-300 text-lg leading-relaxed">Online randevu sistemi ile bekleme yapmadan, size en uygun saatte aracınızın bakımını uzman ellere teslim edin.</p>
                    </div>
                </div>

                <div class="w-full lg:w-7/12 p-6 md:p-12 lg:p-20 overflow-y-auto bg-white relative">
                    <button onclick="switchView('home-view')" class="absolute top-8 right-8 p-2 rounded-full hover:bg-gray-100 transition text-gray-400 hover:text-primary group">
                        <i data-lucide="x" class="w-6 h-6 group-hover:rotate-90 transition-transform"></i>
                    </button>

                    <div class="max-w-xl mx-auto pt-10">
                        <button onclick="switchView('home-view')" class="mb-8 flex items-center text-gray-500 hover:text-primary transition group text-sm font-medium">
                            <i data-lucide="arrow-left" class="mr-2 w-4 h-4 group-hover:-translate-x-1 transition-transform"></i> Ana Sayfaya Dön
                        </button>

                        <h2 class="text-3xl font-bold text-primary mb-2">Servis Randevusu</h2>
                        <p class="text-gray-500 mb-8">Aracınız için en uygun zamanı seçin.</p>

                        <form id="bookingForm" class="space-y-6">
                            <div class="grid md:grid-cols-2 gap-6">
                                <div class="space-y-2">
                                    <label class="text-xs font-bold text-gray-500 uppercase tracking-wider">Tarih</label>
                                    <input type="date" id="date" required class="w-full p-4 rounded-xl bg-gray-50 border border-gray-200 focus:bg-white focus:border-accent focus:ring-4 focus:ring-accent/10 transition-all outline-none text-gray-700">
                                </div>
                                <div class="space-y-2">
                                    <label class="text-xs font-bold text-gray-500 uppercase tracking-wider">Saat</label>
                                    <select id="time" required class="w-full p-4 rounded-xl bg-gray-50 border border-gray-200 focus:bg-white focus:border-accent focus:ring-4 focus:ring-accent/10 transition-all outline-none text-gray-700 appearance-none cursor-pointer">
                                        <option value="">Seçiniz</option>
                                        <option value="09:00">09:00</option>
                                        <option value="10:00">10:00</option>
                                        <option value="11:00">11:00</option>
                                        <option value="13:30">13:30</option>
                                        <option value="15:00">15:00</option>
                                        <option value="16:00">16:00</option>
                                        <option value="17:00">17:00</option>
                                    </select>
                                </div>
                            </div>

                            <div class="grid md:grid-cols-2 gap-6">
                                <div class="space-y-2">
                                    <label class="text-xs font-bold text-gray-500 uppercase tracking-wider">Ad Soyad</label>
                                    <div class="relative">
                                        <i data-lucide="user" class="absolute left-4 top-1/2 -translate-y-1/2 text-gray-400 w-5 h-5"></i>
                                        <input type="text" id="name" placeholder="Örn: Ahmet Yılmaz" required class="w-full p-4 pl-12 rounded-xl bg-gray-50 border border-gray-200 focus:bg-white focus:border-accent focus:ring-4 focus:ring-accent/10 transition-all outline-none text-gray-700">
                                    </div>
                                </div>
                                <div class="space-y-2">
                                    <label class="text-xs font-bold text-gray-500 uppercase tracking-wider">Telefon</label>
                                    <div class="relative">
                                        <i data-lucide="phone" class="absolute left-4 top-1/2 -translate-y-1/2 text-gray-400 w-5 h-5"></i>
                                        <input type="tel" id="phone" placeholder="05XX..." required inputmode="numeric" maxlength="11" class="w-full p-4 pl-12 rounded-xl bg-gray-50 border border-gray-200 focus:bg-white focus:border-accent focus:ring-4 focus:ring-accent/10 transition-all outline-none text-gray-700">
                                    </div>
                                    <p id="phoneError" class="text-xs text-red-500 hidden animate-pulse">Lütfen başında '0' olacak şekilde 11 haneli numara giriniz.</p>
                                </div>
                            </div>

                            <div class="grid md:grid-cols-2 gap-6">
                                <div class="space-y-2">
                                    <label class="text-xs font-bold text-gray-500 uppercase tracking-wider">Marka</label>
                                    <input type="text" id="brand" placeholder="Örn: Ford" class="w-full p-4 rounded-xl bg-gray-50 border border-gray-200 focus:bg-white focus:border-accent focus:ring-4 focus:ring-accent/10 transition-all outline-none text-gray-700">
                                </div>
                                <div class="space-y-2">
                                    <label class="text-xs font-bold text-gray-500 uppercase tracking-wider">Model</label>
                                    <input type="text" id="model" placeholder="Örn: Transit" class="w-full p-4 rounded-xl bg-gray-50 border border-gray-200 focus:bg-white focus:border-accent focus:ring-4 focus:ring-accent/10 transition-all outline-none text-gray-700">
                                </div>
                            </div>

                            <div class="space-y-2">
                                <label class="text-xs font-bold text-gray-500 uppercase tracking-wider">Notunuz</label>
                                <textarea id="issue" rows="3" placeholder="Araçtaki şikayetinizi kısaca belirtiniz..." class="w-full p-4 rounded-xl bg-gray-50 border border-gray-200 focus:bg-white focus:border-accent focus:ring-4 focus:ring-accent/10 transition-all outline-none text-gray-700 resize-none"></textarea>
                            </div>
                            
                            <button type="submit" class="w-full bg-primary hover:bg-primary-dark text-white font-bold py-5 rounded-xl shadow-xl hover:shadow-2xl transition-all transform active:scale-95 flex items-center justify-center gap-3 mt-4">
                                <span>Randevuyu Onayla</span>
                                <i data-lucide="check-circle" class="w-5 h-5 text-accent"></i>
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <div id="success-view" class="view-section min-h-screen bg-gray-50">
            <div class="flex items-center justify-center min-h-screen p-6">
                <div class="bg-white p-12 rounded-3xl shadow-2xl text-center max-w-lg w-full relative overflow-hidden animate-fade-in-up">
                    <div class="absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-primary via-accent to-primary"></div>
                    
                    <div class="w-24 h-24 bg-green-50 rounded-full flex items-center justify-center mx-auto mb-8 animate-[bounce_1s_infinite]">
                        <i data-lucide="check" class="w-12 h-12 text-green-500"></i>
                    </div>
                    
                    <h2 class="text-3xl font-bold text-primary mb-4">Randevunuz Alındı!</h2>
                    <p class="text-gray-500 mb-10 leading-relaxed">Talebiniz bize ulaştı. Müşteri temsilcimiz en kısa sürede teyit için sizi arayacaktır.</p>
                    
                    <button onclick="switchView('home-view')" class="bg-primary text-white px-10 py-4 rounded-xl font-bold hover:bg-primary-dark transition w-full shadow-lg transform active:scale-95">
                        Ana Sayfaya Dön
                    </button>
                </div>
            </div>
        </div>

        <div id="admin-login-view" class="view-section min-h-screen bg-gray-50 pt-28 px-4 pb-12">
            <div class="max-w-md mx-auto p-8 bg-white rounded-2xl shadow-lg">
                <h3 class="text-2xl font-bold text-primary mb-2">Yönetici Girişi</h3>
                <p class="text-gray-500 mb-6 text-sm">Kullanıcı adı (e-posta) ve şifrenizle giriş yapın.</p>
                <form id="adminLoginForm" class="space-y-4">
                    <input id="adminEmail" type="email" required placeholder="E-posta" class="w-full p-3 border rounded-xl" />
                    <input id="adminPassword" type="password" required placeholder="Şifre" class="w-full p-3 border rounded-xl" />
                    <div class="flex justify-between items-center">
                        <button type="submit" class="bg-primary text-white px-5 py-2 rounded-xl font-bold">Giriş Yap</button>
                        <button type="button" onclick="switchView('home-view')" class="text-gray-500">İptal</button>
                    </div>
                    <p id="adminLoginError" class="text-sm text-red-500 hidden"></p>
                </form>

                <div class="mt-4 text-center">
                    <button id="forgotBtn" class="text-sm text-primary font-medium hover:underline">Şifremi Unuttum?</button>
                    <div id="passwordResetArea" class="mt-3 hidden">
                        <p class="text-sm text-gray-600 mb-2">E-posta adresinizi girip "Sıfırlama E-postası Gönder" butonuna basın. Gönderildikten sonra gelen kutunuzu kontrol edin.</p>
                        <div class="flex gap-2 justify-center">
                            <button id="sendResetBtn" class="bg-accent text-primary px-4 py-2 rounded-xl font-bold">Sıfırlama E-postası Gönder</button>
                            <button id="cancelResetBtn" class="px-4 py-2 rounded-xl border">İptal</button>
                        </div>
                        <p id="passwordResetMessage" class="text-sm mt-3 hidden"></p>
                    </div>
                </div> 
            </div>
        </div>

        <div id="admin-view" class="view-section min-h-screen bg-gray-50 pt-28 px-4 pb-12">
            <div class="max-w-6xl mx-auto animate-fade-in-up">
                <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4">
                    <div>
                        <h2 class="text-3xl font-bold text-primary">Yönetici Paneli</h2>
                        <p class="text-gray-500 text-sm">Randevu ve iş takibi</p>
                    </div>
                    <div class="flex flex-col sm:flex-row items-center gap-3 w-full md:w-auto">
                        <div class="flex bg-white p-1 rounded-lg border shadow-sm w-full sm:w-auto overflow-x-auto">
                            <button onclick="setAdminFilter('pending')" id="filterPending" class="flex-1 sm:flex-none px-4 py-2 rounded-md text-sm font-medium transition-all whitespace-nowrap">Bekleyen</button>
                            <button onclick="setAdminFilter('approved')" id="filterApproved" class="flex-1 sm:flex-none px-4 py-2 rounded-md text-sm font-medium transition-all whitespace-nowrap">Onaylanan</button>
                            <button onclick="setAdminFilter('past')" id="filterPast" class="flex-1 sm:flex-none px-4 py-2 rounded-md text-sm font-medium transition-all whitespace-nowrap">Geçmiş</button>
                            <button onclick="setAdminFilter('all')" id="filterAll" class="flex-1 sm:flex-none px-4 py-2 rounded-md text-sm font-medium transition-all whitespace-nowrap">Tümü</button>
                        </div>
                        <div class="flex gap-2 w-full sm:w-auto">
                            <button onclick="signOutAndReturn()" class="flex-1 sm:flex-none px-4 py-2 bg-red-50 border border-red-100 rounded-lg text-red-600 hover:bg-red-100 font-medium transition text-sm">Çıkış</button>
                        </div>
                    </div>
                </div>
                
                <div id="adminMobileCards" class="md:hidden space-y-4">
                    <div class="text-center text-gray-400 py-8">Yükleniyor...</div>
                </div>

                <div class="hidden md:block bg-white rounded-2xl shadow-sm border border-gray-200 overflow-hidden">
                    <div class="overflow-x-auto">
                        <table class="w-full text-left">
                            <thead class="bg-primary text-white">
                                <tr>
                                    <th class="p-5 font-semibold text-sm w-32">Tarih</th>
                                    <th class="p-5 font-semibold text-sm w-48">Müşteri</th>
                                    <th class="p-5 font-semibold text-sm w-40">Araç</th>
                                    <th class="p-5 font-semibold text-sm">Not / Şikayet</th>
                                    <th class="p-5 font-semibold text-sm w-32">Durum</th>
                                    <th class="p-5 font-semibold text-sm w-48 text-right">İşlemler</th>
                                </tr>
                            </thead>
                            <tbody id="adminTableBody" class="divide-y divide-gray-100 text-sm">
                                <tr><td colspan="6" class="p-8 text-center text-gray-500">Veriler yükleniyor...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>

            </div>
        </div>

    </main>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth, signInAnonymously, signInWithEmailAndPassword, sendPasswordResetEmail, signOut, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        import { getFirestore, collection, query, onSnapshot, addDoc, serverTimestamp, updateDoc, doc, deleteDoc, setDoc, getDoc, arrayUnion, arrayRemove } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        const firebaseConfig = {
            apiKey: "AIzaSyCBiWJYqg2OLIV519El6LGY5RSM4EPcU_0",
            authDomain: "celikbas-site.firebaseapp.com",
            projectId: "celikbas-site",
            storageBucket: "celikbas-site.firebasestorage.app",
            messagingSenderId: "94129211350",
            appId: "1:94129211350:web:e24b08aec0eb1633f00677",
            measurementId: "G-NX0EW3S9PV"
        };

        const appId = 'celikbas-v1';
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // Debug
        window.auth = auth;
        window.getAdminEmails = () => adminEmails;

        const initAuth = async () => {
          try {
            await signInAnonymously(auth);
            console.log("Firebase bağlantısı başarılı.");
          } catch (error) {
            console.error("Bağlantı Hatası:", error);
          }
        };
        initAuth();

        let adminEmails = ['admin@example.com','clashpanic31@gmail.com','mahmutceliikk0@gmail.com','yusufenescaybas3@gmail.com']; 
        let currentAdminFilter = 'pending'; 

        function isAdminUser(user) {
            return user && !user.isAnonymous && adminEmails.includes(user.email);
        }

        function setAdminFilter(filter) {
            currentAdminFilter = filter;
            document.querySelectorAll('#filterPending, #filterApproved, #filterPast, #filterAll').forEach(btn => {
                btn.classList.remove('bg-accent','text-white');
                btn.classList.add('bg-white');
            });
            const active = {
                'pending':'filterPending',
                'approved':'filterApproved',
                'past':'filterPast',
                'all':'filterAll'
            }[filter];
            const el = document.getElementById(active);
            if(el){ el.classList.remove('bg-white'); el.classList.add('bg-accent','text-white'); }
            
            // Re-render with new filter
            renderAdminTable(lastAdminSnapshotData, isAdminUser(auth.currentUser));
        }

        const qAppointments = query(collection(db, 'artifacts', appId, 'public', 'data', 'appointments'));
        let lastAdminSnapshotData = [];

        // GÜNCELLENEN RENDER FONKSİYONU (Kart ve Tablo Desteği + Metin Kaydırma)
        function renderAdminTable(data, isAdmin) {
            const tbody = document.getElementById('adminTableBody');
            const mobileContainer = document.getElementById('adminMobileCards');
            
            if(!tbody || !mobileContainer) return;

            // Filtreleme Mantığı
            const today = new Date().toISOString().split('T')[0];
            const filtered = data.filter(a => {
                if(currentAdminFilter === 'all') return true;
                if(currentAdminFilter === 'pending') return a.status === 'bekliyor' || !a.status;
                if(currentAdminFilter === 'approved') return a.status === 'onaylandı' || a.status === 'approved';
                if(currentAdminFilter === 'past') return (a.status === 'tamamlandı' || a.status === 'reddedildi') || (a.date && a.date < today);
                return true;
            });

            tbody.innerHTML = '';
            mobileContainer.innerHTML = '';

            if(filtered.length === 0) {
                const emptyMsg = '<div class="p-8 text-center text-gray-400">Bu kategoride kayıt bulunamadı.</div>';
                tbody.innerHTML = `<tr><td colspan="6">${emptyMsg}</td></tr>`;
                mobileContainer.innerHTML = `<div class="bg-white p-8 rounded-2xl text-center text-gray-400 shadow-sm">Kayıt yok.</div>`;
                return;
            }

            filtered.forEach(apt => {
                // Durum Renkleri ve Metinleri
                let statusConfig = { text: 'Bekliyor', color: 'bg-yellow-100 text-yellow-700 border-yellow-200' };
                if (apt.status === 'onaylandı' || apt.status === 'approved') statusConfig = { text: 'Onaylandı', color: 'bg-green-100 text-green-700 border-green-200' };
                else if (apt.status === 'reddedildi' || apt.status === 'rejected') statusConfig = { text: 'Reddedildi', color: 'bg-red-100 text-red-700 border-red-200' };
                else if (apt.status === 'tamamlandı' || apt.status === 'completed') statusConfig = { text: 'Tamamlandı', color: 'bg-gray-100 text-gray-700 border-gray-200' };

                const isFinalStatus = ['tamamlandı', 'reddedildi', 'completed', 'rejected'].includes(apt.status);

                // --- Buton Grubu HTML'i (Hem Mobil Hem Masaüstü için ortak) ---
                // --- Buton Grubu HTML'i (GÜNCELLENDİ) ---
                let buttonsHtml = '';
                if(isAdmin) {
                    if (!isFinalStatus) {
                        buttonsHtml = `<div class="flex gap-2 justify-end w-full">`;
                        
                        // 1. Onayla Butonu: Eğer zaten onaylı DEĞİLSE göster
                        if (apt.status !== 'onaylandı') {
                            buttonsHtml += `<button data-id="${apt.id}" data-action="approve" class="action-btn flex-1 sm:flex-none px-3 py-2 bg-green-50 text-green-700 hover:bg-green-100 border border-green-200 rounded-lg text-xs font-bold transition flex items-center justify-center gap-1"><i data-lucide="check" class="w-3 h-3"></i> Onayla</button>`;
                        }

                        // 2. Reddet/İptal Butonu Ayarı
                        // Eğer randevu "Onaylandı" ise buton "İptal Et" yazsın, yoksa "Reddet" yazsın.
                        const rejectLabel = apt.status === 'onaylandı' ? 'İptal Et' : 'Reddet';

                        buttonsHtml += `
                            <button data-id="${apt.id}" data-action="reject" class="action-btn flex-1 sm:flex-none px-3 py-2 bg-red-50 text-red-700 hover:bg-red-100 border border-red-200 rounded-lg text-xs font-bold transition flex items-center justify-center gap-1"><i data-lucide="x" class="w-3 h-3"></i> ${rejectLabel}</button>
                            <button data-id="${apt.id}" data-action="complete" class="action-btn flex-1 sm:flex-none px-3 py-2 bg-blue-50 text-blue-700 hover:bg-blue-100 border border-blue-200 rounded-lg text-xs font-bold transition flex items-center justify-center gap-1"><i data-lucide="check-circle-2" class="w-3 h-3"></i> Bitti</button>
                        </div>`;
                    } else {
                        buttonsHtml = `<span class="text-xs text-gray-400 font-medium italic flex items-center justify-end gap-1"><i data-lucide="lock" class="w-3 h-3"></i> İşlem Kapalı</span>`;
                    }
                } else {
                    buttonsHtml = `<span class="text-xs text-gray-400">Yetkisiz</span>`;
                }                  

                // --- 1. MASAÜSTÜ TABLO SATIRI (Desktop Row) ---
                const tr = document.createElement('tr');
                tr.className = "hover:bg-gray-50 transition-colors border-b border-gray-50 last:border-0";
                tr.innerHTML = `
                    <td class="p-5 align-top">
                        <div class="font-bold text-primary text-base">${apt.date}</div>
                        <div class="text-xs text-gray-500 bg-gray-100 inline-flex items-center gap-1 px-2 py-1 rounded mt-1">
                            <i data-lucide="clock" class="w-3 h-3"></i> ${apt.time}
                        </div>
                    </td>
                    <td class="p-5 align-top">
                        <div class="font-medium text-gray-900">${apt.name}</div>
                        <a href="tel:${apt.phone}" class="text-xs text-gray-500 hover:text-accent flex items-center gap-1 mt-1 transition"><i data-lucide="phone" class="w-3 h-3"></i> ${apt.phone}</a>
                    </td>
                    <td class="p-5 align-top text-gray-600">
                        <div class="font-medium text-sm">${apt.vehicleBrand || '-'}</div>
                        <div class="text-xs bg-white border px-1.5 py-0.5 rounded inline-block mt-1">${apt.vehicleModel || ''}</div>
                    </td>
                    <td class="p-5 align-top text-gray-500">
                        <div class="text-sm whitespace-normal break-words leading-relaxed min-w-[200px] bg-gray-50/50 p-2 rounded-lg border border-gray-100">
                            ${apt.issue || '-'}
                        </div>
                    </td>
                    <td class="p-5 align-top">
                        <span class="inline-flex items-center px-2.5 py-1 rounded-full text-xs font-bold border ${statusConfig.color}">
                            ${statusConfig.text}
                        </span>
                    </td>
                    <td class="p-5 align-top text-right">
                        ${buttonsHtml}
                    </td>
                `;
                tbody.appendChild(tr);

                // --- 2. MOBİL KART GÖRÜNÜMÜ (Mobile Card) ---
                const card = document.createElement('div');
                card.className = "bg-white p-5 rounded-2xl shadow-sm border border-gray-100 flex flex-col gap-4 relative overflow-hidden";
                card.innerHTML = `
                    <div class="absolute left-0 top-0 bottom-0 w-1.5 ${statusConfig.color.replace('text-', 'bg-').split(' ')[0]}"></div>
                    
                    <div class="flex justify-between items-start pl-2">
                        <div class="flex flex-col">
                            <span class="font-bold text-lg text-primary tracking-tight">${apt.date}</span>
                            <div class="flex items-center gap-2 text-sm text-gray-500 mt-0.5">
                                <i data-lucide="clock" class="w-4 h-4"></i> ${apt.time}
                            </div>
                        </div>
                        <span class="px-3 py-1 rounded-full text-xs font-bold border ${statusConfig.color}">${statusConfig.text}</span>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-3 pl-2 border-t border-b border-gray-50 py-3">
                        <div>
                            <p class="text-[10px] uppercase text-gray-400 font-bold tracking-wider">Müşteri</p>
                            <p class="font-medium text-primary text-sm">${apt.name}</p>
                            <a href="tel:${apt.phone}" class="text-xs text-gray-500 flex items-center gap-1 mt-1"><i data-lucide="phone" class="w-3 h-3"></i> Ara</a>
                        </div>
                        <div>
                            <p class="text-[10px] uppercase text-gray-400 font-bold tracking-wider">Araç</p>
                            <p class="font-medium text-primary text-sm">${apt.vehicleBrand || '-'}</p>
                            <p class="text-xs text-gray-500">${apt.vehicleModel || ''}</p>
                        </div>
                    </div>

                    <div class="pl-2">
                        <p class="text-[10px] uppercase text-gray-400 font-bold tracking-wider mb-1">Not / Şikayet</p>
                        <div class="text-sm text-gray-600 bg-gray-50 p-3 rounded-xl border border-gray-100 leading-relaxed whitespace-normal break-words">
                            ${apt.issue || 'Not belirtilmemiş.'}
                        </div>
                    </div>

                    <div class="pl-2 pt-1">
                        ${buttonsHtml}
                    </div>
                `;
                mobileContainer.appendChild(card);
            });

            if (typeof lucide !== 'undefined') lucide.createIcons();

            // Buton Olayları (Ortak)
            document.querySelectorAll('.action-btn').forEach(btn => {
                btn.onclick = async (e) => {
                    const targetBtn = e.target.closest('button');
                    const id = targetBtn.getAttribute('data-id');
                    const action = targetBtn.getAttribute('data-action');
                    
                    let newStatus = 'bekliyor';
                    let confirmMsg = '';

                    if(action === 'approve') { newStatus = 'onaylandı'; confirmMsg = 'Randevuyu onaylıyor musunuz?'; }
                    if(action === 'reject') { newStatus = 'reddedildi'; confirmMsg = 'Randevuyu reddetmek istediğinize emin misiniz?'; }
                    if(action === 'complete') { newStatus = 'tamamlandı'; confirmMsg = 'İşlemi tamamlandı olarak işaretliyor musunuz?'; }

                    if(!confirm(confirmMsg)) return;
                    
                    targetBtn.disabled = true;
                    targetBtn.innerHTML = '<i data-lucide="loader-2" class="w-3 h-3 animate-spin"></i>';
                    if (typeof lucide !== 'undefined') lucide.createIcons();

                    try {
                        await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'appointments', id), {
                            status: newStatus,
                            updatedAt: serverTimestamp()
                        });
                    } catch(err){
                        console.error('Güncelleme hatası',err);
                        alert('Hata: ' + err.message);
                        targetBtn.disabled = false;
                    }
                };
            });
        }

        onSnapshot(qAppointments, (snapshot) => {
            let data = snapshot.docs.map(d => ({ id: d.id, ...d.data() }));
            data.sort((a,b) => (b.createdAt?.seconds || 0) - (a.createdAt?.seconds || 0));
            lastAdminSnapshotData = data;
            renderAdminTable(data, isAdminUser(auth.currentUser));
        }, (error) => {
            console.error("Veri çekme hatası:", error);
        });

        onAuthStateChanged(auth, (user) => {
            renderAdminTable(lastAdminSnapshotData, isAdminUser(user));
        });

        // FORM
        const form = document.getElementById('bookingForm');
        if(form) {
            const dateInput = document.getElementById('date');
            if(dateInput) {
                dateInput.min = new Date().toISOString().split('T')[0];
                dateInput.addEventListener('change', (e) => {
                    const selectedDate = new Date(e.target.value);
                    if(selectedDate.getDay() === 0) { 
                        alert("Pazar günleri servisimiz kapalıdır. Lütfen başka bir gün seçiniz.");
                        e.target.value = ''; 
                    }
                });
            }

            const phoneField = document.getElementById('phone');
            if (phoneField) {
                phoneField.addEventListener('input', (e) => {
                    let val = e.target.value.replace(/\D/g, '').slice(0, 11);
                    e.target.value = val;
                    document.getElementById('phoneError').classList.add('hidden');
                });
            }

            form.addEventListener('submit', async (e) => {
                e.preventDefault();
                
                if (!auth.currentUser) {
                    alert("Sistem bağlantısı kuruluyor veya yapılandırma hatası var. Lütfen konsolu kontrol edin.");
                    return;
                }

                const phoneInput = document.getElementById('phone');
                const phoneVal = phoneInput.value;
                const dateVal = document.getElementById('date').value;
                const timeVal = document.getElementById('time').value;

                if (phoneVal.length !== 11 || !phoneVal.startsWith('05')) {
                    document.getElementById('phoneError').textContent = "Lütfen geçerli bir numara giriniz (Örn: 0536...).";
                    document.getElementById('phoneError').classList.remove('hidden');
                    phoneInput.focus();
                    return;
                }

                if (dateVal === new Date().toISOString().split('T')[0]) {
                   const now = new Date();
                   const currentHour = now.getHours();
                   const currentMin = now.getMinutes();
                   const [selectedHour, selectedMin] = timeVal.split(':').map(Number);
                   
                   if (selectedHour < currentHour || (selectedHour === currentHour && selectedMin < currentMin)) {
                       alert("Geçmiş bir saat seçemezsiniz. Lütfen ileri bir saat seçin.");
                       return;
                   }
                }

                const btn = e.target.querySelector('button[type="submit"]');
                const originalContent = btn.innerHTML;
                
                btn.innerHTML = `<i data-lucide="loader-2" class="w-5 h-5 animate-spin"></i> İşleniyor...`;
                btn.disabled = true;
                if (typeof lucide !== 'undefined') lucide.createIcons();

                try {
                    await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'appointments'), {
                        date: dateVal,
                        time: timeVal,
                        name: document.getElementById('name').value,
                        phone: phoneVal,
                        vehicleBrand: document.getElementById('brand').value,
                        vehicleModel: document.getElementById('model').value,
                        issue: document.getElementById('issue').value,
                        createdAt: serverTimestamp(),
                        status: 'bekliyor'
                    });
                    
                    window.switchView('success-view');
                    e.target.reset();
                } catch (err) {
                    console.error("Kayıt Hatası:", err);
                    alert("Bir hata oluştu: " + err.message);
                } finally {
                    btn.innerHTML = originalContent;
                    btn.disabled = false;
                    if (typeof lucide !== 'undefined') lucide.createIcons();
                }
            });
        }
        
        // ADMIN LOGIN
        const adminLoginForm = document.getElementById('adminLoginForm');
        if (adminLoginForm) {
            adminLoginForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const errEl = document.getElementById('adminLoginError');
                try {
                    const email = document.getElementById('adminEmail').value.trim();
                    const password = document.getElementById('adminPassword').value;
                    await signInWithEmailAndPassword(auth, email, password);
                    if (!adminEmails.includes(email)) {
                        await signOut(auth);
                        errEl.textContent = 'Bu hesap yönetici değil. Lütfen yönetici hesabı ile giriş yapın.';
                        errEl.classList.remove('hidden');
                        return;
                    }
                    switchView('admin-view');
                } catch (err) {
                    console.error('Admin login error', err);
                    errEl.textContent = err.message || 'Giriş yapılamadı.';
                    errEl.classList.remove('hidden');
                }
            });
        }

        // RESET PW
        const forgotBtn = document.getElementById('forgotBtn');
        const passwordResetArea = document.getElementById('passwordResetArea');
        const sendResetBtn = document.getElementById('sendResetBtn');
        const cancelResetBtn = document.getElementById('cancelResetBtn');
        const passwordResetMessage = document.getElementById('passwordResetMessage');

        if (forgotBtn) {
            forgotBtn.addEventListener('click', () => {
                passwordResetArea.classList.toggle('hidden');
                if (passwordResetMessage) passwordResetMessage.classList.add('hidden');
            });
        }
        if (cancelResetBtn) {
            cancelResetBtn.addEventListener('click', () => {
                passwordResetArea.classList.add('hidden');
            });
        }
        if (sendResetBtn) {
            sendResetBtn.addEventListener('click', async () => {
                const email = (document.getElementById('adminEmail') || {}).value;
                if (!passwordResetMessage) return;
                passwordResetMessage.classList.remove('hidden');
                passwordResetMessage.textContent = 'İşleniyor...';
                try {
                    if (!email || !/^\S+@\S+\.\S+$/.test(email)) throw new Error('Geçerli bir e-posta giriniz.');
                    await sendPasswordResetEmail(auth, email);
                    passwordResetMessage.textContent = 'Sıfırlama e-postası gönderildi.';
                    passwordResetMessage.classList.add('text-green-500');
                } catch (err) {
                    passwordResetMessage.textContent = err.message;
                    passwordResetMessage.classList.add('text-red-500');
                }
            });
        }

        async function signOutAndReturn() {
            try { await signOut(auth); } catch (err) {}
            switchView('home-view');
        }

        window.setAdminFilter = setAdminFilter;
        window.signOutAndReturn = signOutAndReturn;
        window.isAdmin = () => isAdminUser(auth.currentUser);
        setAdminFilter(currentAdminFilter);
    </script>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            if (typeof lucide !== 'undefined') lucide.createIcons();
            initScrollObserver();
        });

        function initScrollObserver() {
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) entry.target.classList.add('active');
                });
            }, { threshold: 0.1 });
            document.querySelectorAll('.reveal').forEach(el => observer.observe(el));
        }

        function toggleMobileMenu() {
            const overlay = document.getElementById('mobile-menu-overlay');
            const content = document.getElementById('mobile-menu-content');
            if (overlay.classList.contains('invisible')) {
                overlay.classList.remove('invisible', 'opacity-0');
                setTimeout(() => content.classList.remove('translate-x-full'), 10);
            } else {
                content.classList.add('translate-x-full');
                setTimeout(() => {
                    overlay.classList.add('opacity-0');
                    setTimeout(() => overlay.classList.add('invisible'), 300);
                }, 300);
            }
        }

        function mobileNavigate(sectionId) {
            toggleMobileMenu();
            setTimeout(() => scrollToSection(sectionId), 400);
        }

        function scrollToSection(id) {
            const currentView = document.querySelector('.view-section.active');
            if (currentView && currentView.id !== 'home-view') {
                switchView('home-view');
                setTimeout(() => {
                    const el = document.getElementById(id);
                    if(el) el.scrollIntoView({behavior: 'smooth', block: 'start'});
                }, 500);
            } else {
                const el = document.getElementById(id);
                if(el) el.scrollIntoView({behavior: 'smooth', block: 'start'});
            }
        }

        function switchView(viewId) {
            if (viewId === 'admin-view' && !(window.isAdmin && window.isAdmin())) viewId = 'admin-login-view';
            const current = document.querySelector('.view-section.active');
            const next = document.getElementById(viewId);
            if (current === next) return;
            if(current) {
                current.style.opacity = '0';
                current.style.transform = 'translateY(-10px)';
                setTimeout(() => {
                    current.classList.remove('active');
                    current.style.transform = '';
                    if(next) {
                        window.scrollTo({top: 0});
                        next.classList.add('active');
                        if (typeof lucide !== 'undefined') lucide.createIcons();
                        initScrollObserver();
                    }
                }, 400);
            } else {
                if(next) next.classList.add('active');
            }
        }

        window.addEventListener('scroll', () => {
            const nav = document.getElementById('navbar');
            if (window.scrollY > 50) nav.classList.add('shadow-glass');
            else nav.classList.remove('shadow-glass');
        });

        window.toggleMobileMenu = toggleMobileMenu;
        window.mobileNavigate = mobileNavigate;
        window.scrollToSection = scrollToSection;
        window.switchView = switchView;
    </script>
</body>
</html>
